From b034d21a5f3422b29eddbe21fa385fa6fddd24b8 Mon Sep 17 00:00:00 2001
From: Raul Metsma <raul@metsma.ee>
Date: Thu, 25 Oct 2018 13:47:18 +0300
Subject: [PATCH] Add ubuntu 18.10 and fix build and lintian error (#244)

Signed-off-by: Raul Metsma <raul@metsma.ee>
---
 .travis.yml                      | 6 +++++-
 CMakeLists.txt                   | 2 +-
 debian/control                   | 2 +-
 debian/libdigidocpp-dev.triggers | 1 +
 src/Container.cpp                | 7 ++++---
 5 files changed, 12 insertions(+), 6 deletions(-)
 create mode 100644 debian/libdigidocpp-dev.triggers

diff --git a/.travis.yml b/.travis.yml
index c5aac9f..4cd16ab 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -7,6 +7,9 @@ matrix:
   - os: linux
     env: TARGET=ubuntu:18.04
     sudo: false
+  - os: linux
+    env: TARGET=ubuntu:18.10
+    sudo: false
   - os: linux
     env: TARGET=i386/ubuntu:16.04
     sudo: false
@@ -69,7 +72,7 @@ script: case ${TARGET} in
       apt-get install -y dh-make devscripts cdbs cmake vim-common xsdcxx libxml-security-c-dev libminizip-dev doxygen swig openjdk-8-jdk-headless libboost-test-dev git curl wget ruby;
       export VERSION=$(grep project CMakeLists.txt | egrep -o "([0-9]{1,}\.)+[0-9]{1,}").${BUILD_NUMBER};
       export DEBFULLNAME="Travis";
-      export DEBEMAIL="travis-ci@travis";
+      export DEBEMAIL="travis-ci@travis-ci.org";
       dh_make --createorig --addmissing --defaultless -y -p libdigidocpp_${VERSION};
       dch --distribution $(lsb_release -cs) -v ${VERSION} "Release ${VERSION}.";
       dpkg-buildpackage -rfakeroot -us -uc;
@@ -81,6 +84,7 @@ script: case ${TARGET} in
         export COVERITY_SCAN_BUILD_COMMAND=make;
         wget -O - https://scan.coverity.com/scripts/travisci_build_coverity_scan.sh | bash;
       fi;
+      lintian ../*.deb;
       git clean -dxf';
   esac
 
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 24417fe..3cafd3d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,5 +1,5 @@
 cmake_minimum_required(VERSION 3.5)
-project(libdigidocpp VERSION 3.13.7)
+project(libdigidocpp VERSION 3.13.8)
 if(POLICY CMP0074)
     cmake_policy(SET CMP0074 NEW)
 endif()
diff --git a/debian/control b/debian/control
index 3930806..2584804 100644
--- a/debian/control
+++ b/debian/control
@@ -1,6 +1,6 @@
 Source: libdigidocpp
 Section: libs
-Priority: extra
+Priority: optional
 Maintainer: RIA <info@ria.ee>
 Build-Depends:
  cdbs,
diff --git a/debian/libdigidocpp-dev.triggers b/debian/libdigidocpp-dev.triggers
new file mode 100644
index 0000000..dd86603
--- /dev/null
+++ b/debian/libdigidocpp-dev.triggers
@@ -0,0 +1 @@
+activate-noawait ldconfig
diff --git a/src/Container.cpp b/src/Container.cpp
index 6a06d55..186678c 100644
--- a/src/Container.cpp
+++ b/src/Container.cpp
@@ -37,7 +37,8 @@ DIGIDOCPP_WARNING_DISABLE_MSVC(4005)
 #include <xercesc/util/XMLString.hpp>
 #include <xsec/utils/XSECPlatformUtils.hpp>
 DIGIDOCPP_WARNING_POP
-#if !defined(XSEC_NO_XALAN) || defined(XSEC_HAVE_XALAN)
+#if XSEC_VERSION_MAJOR == 1 && !defined(XSEC_NO_XALAN) || defined(XSEC_HAVE_XALAN)
+#define USE_XALAN
 #include <xalanc/XPath/XPathEvaluator.hpp>
 DIGIDOCPP_WARNING_PUSH
 DIGIDOCPP_WARNING_DISABLE_GCC("-Wunused-parameter")
@@ -105,7 +106,7 @@ void digidoc::initialize(const string &appInfo, initCallBack callBack)
 
     try {
         XMLPlatformUtils::Initialize();
-#if !defined(XSEC_NO_XALAN) || defined(XSEC_HAVE_XALAN)
+#ifdef USE_XALAN
         XPathEvaluator::initialize();
         XalanTransformer::initialize();
 #endif
@@ -156,7 +157,7 @@ void digidoc::terminate()
     Conf::init(nullptr);
 
     XSECPlatformUtils::Terminate();
-#if !defined(XSEC_NO_XALAN) || defined(XSEC_HAVE_XALAN)
+#ifdef USE_XALAN
     XalanTransformer::terminate();
     XPathEvaluator::terminate();
 #endif
